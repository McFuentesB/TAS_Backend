version: "3.9"

services:
  mysql:
    image: mysql:8.0
    container_name: tas-mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: tas_db
      MYSQL_USER: tas_user
      MYSQL_PASSWORD: tas_pass
    volumes:
      - mysql_data:/var/lib/mysql
    networks:
      - tas-net

  usuario:
    image: mati012/tas-usuario:1.0
    container_name: usuario
    restart: always
    environment:
      SERVER_PORT: 8081
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/tas_db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
      SPRING_DATASOURCE_USERNAME: tas_user
      SPRING_DATASOURCE_PASSWORD: tas_pass
    depends_on:
      - mysql
    networks:
      - tas-net

  profesion:
    image: mati012/tas-profesion:1.0
    container_name: profesion
    restart: always
    environment:
      SERVER_PORT: 8082
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/tas_db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
      SPRING_DATASOURCE_USERNAME: tas_user
      SPRING_DATASOURCE_PASSWORD: tas_pass
    depends_on:
      - mysql
    networks:
      - tas-net

  cita:
    image: mati012/tas-cita:1.1
    container_name: cita
    restart: always
    environment:
      SERVER_PORT: 8083
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/tas_db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
      SPRING_DATASOURCE_USERNAME: tas_user
      SPRING_DATASOURCE_PASSWORD: tas_pass
    depends_on:
      - mysql
    networks:
      - tas-net

  bff:
    image: mati012/tas-bff:1.1
    container_name: bff
    restart: always
    environment:
      SERVER_PORT: 8080
      MICROSERVICES_USUARIO_URL: http://usuario:8081
      MICROSERVICES_PROFESION_URL: http://profesion:8082
      MICROSERVICES_CITA_URL: http://cita:8083
    depends_on:
      - usuario
      - profesion
      - cita
    ports:
      - "8080:8080"
    networks:
      - tas-net



networks:
  tas-net:

volumes:
  mysql_data:
